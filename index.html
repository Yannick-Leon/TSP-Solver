<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TSP Routenplaner</title>
  <meta name="description" content="Koordinaten in die beste Reihenfolge bringen (TSP) â€“ mit Heuristiken, 2-Opt, Geocoding & Leaflet-Karte." />
  <link rel="stylesheet" href="styles.css" />
  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
</head>
<body>
  <header class="app-header">
    <h1>ğŸ—ºï¸ TSP Routenplaner</h1>
    <p class="subtitle">FÃ¼ge Punkte oder Adressen hinzu, wÃ¤hle eine Methode und finde eine gute Route.</p>
  </header>

  <main class="app-main" role="main">
    <!-- Sidebar -->
    <aside class="panel left" aria-label="Eingaben und Optionen">
      <section class="card">
        <h2>Punkte eingeben</h2>

        <label for="coordsInput" class="hint">
          Ein Punkt pro Zeile. Format: <code>lat, lon[, label]</code> oder <code>x, y[, label]</code>
        </label>
        <textarea id="coordsInput" rows="6" placeholder="z. B.&#10;52.5200, 13.4050, Berlin&#10;48.8566, 2.3522, Paris"></textarea>

        <div class="row gap">
          <button id="btnParse">â• Punkte Ã¼bernehmen</button>
          <button id="btnClear">ğŸ§¹ Leeren</button>
        </div>

        <div class="row gap">
          <label class="file">
            <input id="fileInput" type="file" accept=".csv,.txt,.json" />
            <span>ğŸ“‚ Datei laden</span>
          </label>
          <button id="btnSample">ğŸ² Demo-Punkte</button>
        </div>
      </section>

      <section class="card">
        <h2>Adressen eingeben</h2>
        <label for="addrInput" class="hint">Eine Adresse pro Zeile (StraÃŸe + Stadt/PLZ/Ort, Land).</label>
        <textarea id="addrInput" rows="6" placeholder="z. B.&#10;Brandenburger Tor, Berlin&#10;Eiffelturm, Paris&#10;Buckingham Palace, London"></textarea>
        <div class="row gap">
          <button id="btnGeocode">ğŸŒ Adressen geocodieren</button>
          <small class="hint">Nutzt Nominatim (OpenStreetMap). Bitte sparsam verwenden.</small>
        </div>
      </section>

      <section class="card">
        <h2>Optionen</h2>

        <div class="field">
          <label for="metricSelect">Distanzmetrik</label>
          <select id="metricSelect">
            <option value="euclidean">Euklidisch (x/y)</option>
            <option value="haversine">Haversine (Lat/Lon)</option>
          </select>
        </div>

        <div class="field">
          <label for="algoSelect">StartlÃ¶sung</label>
          <select id="algoSelect">
            <option value="nearest">Nearest Neighbor</option>
            <option value="insertion">Cheapest Insertion</option>
            <option value="random">ZufÃ¤llige Tour</option>
          </select>
        </div>

        <div class="field inline">
          <input type="checkbox" id="chkFixStart" />
          <label for="chkFixStart">Startpunkt fixieren</label>
        </div>

        <div class="field">
          <label for="startIndex">Startindex (optional)</label>
          <input type="number" id="startIndex" min="0" step="1" placeholder="0" />
        </div>

        <div class="field">
          <label for="improveSelect">Verbesserung</label>
          <select id="improveSelect">
            <option value="2opt">2-Opt</option>
            <option value="none">Keine</option>
          </select>
        </div>

        <div class="field inline">
          <input type="checkbox" id="chkRoundtrip" />
          <label for="chkRoundtrip">Rundtour (Start = Ziel)</label>
        </div>

        <div class="row gap" style="margin-top:10px;">
          <button id="btnSolve" class="primary">ğŸš€ LÃ¶sen</button>
          <button id="btnImprove">ğŸ” Verbessern</button>
        </div>

        <div class="row gap">
          <button id="btnStep">â­ï¸ Schritt</button>
          <button id="btnStop">â¹ï¸ Stop</button>
          <button id="btnReset">â™»ï¸ Reset</button>
        </div>

        <div class="field">
  <label for="routeModeSelect">Routing</label>
  <select id="routeModeSelect">
    <option value="straight">Luftlinie (intern)</option>
    <option value="osrm">StraÃŸe (OSRM)</option>
  </select>
</div>

      </section>

      <section class="card">
        <h2>Export</h2>
        <div class="row wrap gap">
          <button id="btnExportCSV">CSV</button>
          <button id="btnExportJSON">JSON</button>
          <button id="btnExportGeoJSON">GeoJSON</button>
          <button id="btnExportGPX">GPX</button>
        </div>
      </section>

      <section class="card compact">
        <details>
          <summary>Erweiterte Einstellungen</summary>
          <div class="field">
            <label for="seed">Zufalls-Seed (optional)</label>
            <input id="seed" type="number" placeholder="z. B. 42" />
          </div>
          <div class="field">
            <label for="anneal">Simulated Annealing (Beta)</label>
            <input id="anneal" type="checkbox" />
          </div>
          <div class="field">
            <label for="gridSnap">Auf Raster runden</label>
            <input id="gridSnap" type="number" min="0" step="1" value="0" />
            <small class="hint">0 = aus</small>
          </div>
        </details>
      </section>
    </aside>

    <!-- Visualisierung -->
    <section class="panel right" aria-label="Visualisierung und Ergebnisse">
      <section class="card">
        <h2>Visualisierung</h2>
        <div class="canvas-wrap" style="margin-bottom:10px">
          <canvas id="routeCanvas" width="900" height="420" aria-label="Routen-Canvas"></canvas>
          <div id="canvasOverlay" class="overlay" aria-live="polite" aria-atomic="true"></div>
        </div>

        <div class="row gap" style="margin-bottom:10px">
          <button id="btnFit">ğŸ–¼ï¸ Anpassen</button>
          <button id="btnToggleLabels">ğŸ”¤ Labels</button>
          <button id="btnToggleNumbers">ğŸ”¢ Indizes</button>
          <button id="btnToggleCoords">ğŸ“ Koordinaten</button>
          <button id="btnToggleMap">ğŸ—ºï¸ Karte an/aus</button>
        </div>

        <!-- Leaflet Map -->
        <div id="map" class="leaflet-map" aria-label="Karte" style="display:none"></div>
      </section>

      <section class="card">
        <h2>Ergebnis</h2>
        <div class="stats">
          <div><strong>Punkte:</strong> <span id="statNodes">0</span></div>
          <div><strong>Gesamtdistanz:</strong> <span id="statDistance">â€“</span></div>
          <div><strong>Berechnungszeit:</strong> <span id="statTime">â€“</span></div>
          <div><strong>Methode:</strong> <span id="statMethod">â€“</span></div>
        </div>

        <div class="route-list-wrap">
          <h3>Reihenfolge</h3>
          <ol id="routeList" class="route-list"></ol>
        </div>

        <p id="explainText" class="hint" style="margin-top:10px;"></p>
      </section>
    </section>
  </main>

  <footer class="app-footer">
    <span>Â© <span id="year"></span> TSP Routenplaner â€¢ <a href="#" id="linkAbout">Ãœber</a></span>
  </footer>

  <dialog id="aboutDialog" aria-labelledby="aboutTitle">
    <h2 id="aboutTitle">Ãœber dieses Tool</h2>
    <p>Heuristiken (Nearest Neighbor, Cheapest Insertion), 2-Opt, CSV/JSON, Haversine/Euklid. Adress-Geocoding via OpenStreetMap Nominatim. Karte via Leaflet.</p>
    <form method="dialog">
      <button>SchlieÃŸen</button>
    </form>
  </dialog>

  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>

  <!-- App -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
          crossorigin=""></script>
  <script src="app.js" defer></script>
</body>
</html>
