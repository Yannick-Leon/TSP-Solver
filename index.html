<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gesch√ºtzter Zugang</title>
<meta name="robots" content="noindex, nofollow">

<style>
  :root{
    --bg:#0b1020;--card:#11172a;--fg:#e8ecf4;--muted:#a7b0c3;
    --primary:#6aa2ff;--primary-2:#3b82f6;--border:#1d2640;
    --danger:#ef4444;--ok:#22c55e;--warn:#f59e0b;
  }
  *{box-sizing:border-box}
  body{
    margin:0;min-height:100vh;
    font-family:system-ui,-apple-system,Segoe UI,Roboto;
    background:radial-gradient(1000px 600px at 20% 10%,#152147 0%,var(--bg) 60%);
    color:var(--fg);display:grid;place-items:center;padding:24px;
  }
  .wrap{width:min(420px,100%)}
  .card{
    background:linear-gradient(180deg,#131a31 0%,var(--card) 100%);
    border:1px solid var(--border);border-radius:16px;
    padding:22px 18px;box-shadow:0 10px 30px rgba(0,0,0,.35)
  }
  h1{margin:0 0 8px;font-size:22px}
  .sub{margin:0 0 16px;color:var(--muted);font-size:14px}
  .field{margin:12px 0}
  label{display:block;margin:0 0 8px;font-size:13px;color:var(--muted)}
  .control{
    display:grid;grid-template-columns:1fr auto;gap:10px;
    background:#0f162b;border:1px solid var(--border);
    border-radius:12px;padding:10px 12px
  }
  input{
    background:transparent;border:0;outline:0;color:var(--fg);font-size:16px
  }
  button.icon{
    background:#0b1226;color:var(--muted);
    border:1px solid var(--border);
    padding:8px 10px;border-radius:10px;cursor:pointer
  }
  .row{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:10px}
  .left{display:flex;gap:8px;align-items:center}
  input[type=checkbox]{accent-color:var(--primary)}
  button.primary{
    flex:1;background:linear-gradient(180deg,var(--primary),var(--primary-2));
    color:#081022;font-weight:600;border:0;padding:12px 14px;
    border-radius:12px;cursor:pointer
  }
  button.primary:disabled{opacity:.6;cursor:not-allowed}
  .hint{color:var(--muted);font-size:12px;margin-top:8px}
  .err{font-size:13px;min-height:18px;margin-top:8px}
  .err.ok{color:var(--ok)}
  .err.warn{color:var(--warn)}
  .err:not(.ok):not(.warn){color:var(--danger)}
  .footer{margin-top:14px;display:flex;justify-content:space-between;color:var(--muted);font-size:12px}
</style>
</head>

<body>
<div class="wrap">
  <div class="card" role="dialog" aria-labelledby="t">
    <h1 id="t">Gesch√ºtzter Zugang</h1>
    <p class="sub">Bitte gib dein Passwort ein, um fortzufahren.</p>

    <div class="field">
      <label for="pw">Passwort</label>
      <div class="control">
        <input id="pw" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        <button id="toggle" class="icon" type="button">üëÅÔ∏è</button>
      </div>
      <div id="err" class="err"></div>
    </div>

    <div class="row">
      <div class="left">
        <input type="checkbox" id="remember">
        <label for="remember">7 Tage merken</label>
      </div>
      <button id="submit" class="primary" type="button">Weiter</button>
    </div>

    <p class="hint">Client-seitiger Schutz (leichte Paywall).</p>
    <div class="footer">
      <span id="status">TSP Solver</span>
      <span>&copy; <span id="y"></span></span>
    </div>
  </div>
</div>

<script>
(() => {
  const PASSWORD = "changeme_2025";      // ‚Üê HIER Passwort √§ndern
  const REDIRECT_URL = "./app.html";     // ‚Üê Zielseite (TSP)
  const MAX_ATTEMPTS = 5;
  const COOLDOWN_SEC = 60;
  const REMEMBER_DAYS = 7;

  const pw = document.getElementById('pw');
  const toggle = document.getElementById('toggle');
  const submit = document.getElementById('submit');
  const err = document.getElementById('err');
  const remember = document.getElementById('remember');
  const year = document.getElementById('y');
  if (year) year.textContent = new Date().getFullYear();

  // Auto-Redirect wenn Ticket g√ºltig
  const ticket = getTicket();
  if (ticket) {
    const next = new URLSearchParams(location.search).get('next');
    location.replace(next || REDIRECT_URL);
    return;
  }

  toggle.onclick = () => {
    pw.type = pw.type === 'password' ? 'text' : 'password';
    pw.focus();
  };

  submit.onclick = () => {
    const value = pw.value.trim();
    if (!value) return setMsg('Bitte Passwort eingeben', 'warn');

    if (value === PASSWORD) {
      setMsg('OK ‚Äì weiterleiten‚Ä¶', 'ok');
      saveTicket(remember.checked ? REMEMBER_DAYS : 0);
      const next = new URLSearchParams(location.search).get('next');
      location.replace(next || REDIRECT_URL);
      return;
    }

    let attempts = Number(localStorage.getItem('pw_attempts') || 0) + 1;
    localStorage.setItem('pw_attempts', attempts);

    if (attempts >= MAX_ATTEMPTS) {
      localStorage.setItem('pw_attempts', 0);
      localStorage.setItem('pw_cooldown', Date.now() + COOLDOWN_SEC * 1000);
      return startCooldown();
    }

    setMsg(`Falsches Passwort (${attempts}/${MAX_ATTEMPTS})`);
    pw.select();
  };

  pw.onkeydown = e => { if (e.key === 'Enter') submit.click(); };

  function startCooldown() {
    submit.disabled = true;
    const timer = setInterval(() => {
      const until = Number(localStorage.getItem('pw_cooldown') || 0);
      const diff = Math.ceil((until - Date.now()) / 1000);
      if (diff <= 0) {
        clearInterval(timer);
        submit.disabled = false;
        setMsg('');
        localStorage.removeItem('pw_cooldown');
        return;
      }
      setMsg(`Zu viele Versuche. Bitte warte ${diff}s ‚Ä¶`, 'warn');
    }, 300);
  }

  function setMsg(text, type) {
    err.textContent = text;
    err.className = 'err ' + (type || '');
  }

  function saveTicket(days) {
    const exp = Date.now() + (days ? days * 864e5 : 2 * 36e5);
    const t = JSON.stringify({ exp });
    (days ? localStorage : sessionStorage).setItem('paywall_ticket', t);
  }

  function getTicket() {
    try {
      for (const s of [localStorage, sessionStorage]) {
        const raw = s.getItem('paywall_ticket');
        if (!raw) continue;
        const t = JSON.parse(raw);
        if (Date.now() < t.exp) return t;
        s.removeItem('paywall_ticket');
      }
    } catch {}
    return null;
  }
})();
</script>
</body>
</html>